<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Bird Clone</title>
    <style>
        body 
        {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom, #87CEEB, #B0E0E6);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∂–µ—Å—Ç—ã –∫–∞—Å–∞–Ω–∏–π */
            user-select: none; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
            -webkit-user-select: none; /* –î–ª—è Safari */
            -moz-user-select: none; /* –î–ª—è Firefox */
            -ms-user-select: none; /* –î–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π IE */
        }
        canvas 
        {
            border: 2px solid #fff;
            max-width: 100%; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –∫–∞–Ω–≤–∞—Å–∞ 100% –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
            height: auto; /* –í—ã—Å–æ—Ç–∞ –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π */
            display: block; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã –∫–∞–Ω–≤–∞—Å –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ */
            margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞–Ω–≤–∞—Å */
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ */
            -webkit-touch-callout: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é iOS */
        }

        #gameOverPanel, #mainMenu, #popup, #shopPanel  
        {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid yellow;
            padding: 20px;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ */
            -webkit-touch-callout: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é iOS */
        }

        #mainMenu, #shopPanel {
    width: 80%;
    max-width: 360px; /* 90% –æ—Ç 400px (—à–∏—Ä–∏–Ω–∞ –∫–∞–Ω–≤–∞—Å–∞) */
    min-width: 280px;
    height: auto;
    min-height: 500px;
    padding: 2vw;
    box-sizing: border-box;
    transform: translate(-50%, -50%);
}

.button-container {
    width: 100%;
    gap: 1.5vh;
}

.button {
    width: 100%;
    padding: 1.5vh 0;
    font-size: calc(12px + 0.5vw);
}

.tabs {
    width: 100%;
}

.shop-grid {
    width: 100%;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
}

        h1 
        {
            font-size: 48px;
            color: white;
            text-shadow: 2px 2px 4px black;
            margin: 0;
        }
        .button 
        {
            margin: 10px;
            padding: 10px 20px;
            background-color: #87CEEB;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 2px black;
            transition: background-color 0.3s;
        }
        .button:hover 
        {
            background-color: #6EC6E3;
        }
        .pause-text 
        {
            font-size: 30px;
            color: red;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        .close 
        {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover 
        {
            color: red;
        }
        .button-container  
        {
            display: flex;
            flex-direction: column; /* –†–∞–∑–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
        }

        .button 
        {
            width: 200px; /* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é —à–∏—Ä–∏–Ω—É */
            margin: 10px 0; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
            padding: 10px; /* –ë–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
        }

        .button-container 
        {
            display: flex;
            flex-direction: column; /* –†–∞–∑–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∑–Ω–∞—á–∫–∞ */
        .restart-button 
        {
            font-size: 20px; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∑–Ω–∞—á–∫–∞ */
            background: none; /* –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω, –µ—Å–ª–∏ —ç—Ç–æ –Ω—É–∂–Ω–æ */
            border: none; /* –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫—É */
            color: black; /* –¶–≤–µ—Ç –∑–Ω–∞—á–∫–∞ */
            cursor: pointer; /* –£–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            padding: 0; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã */
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ "–ú–∞–≥–∞–∑–∏–Ω" */
        #shopBtn 
        {
            background-color: rgb(255, 0, 0); /* –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
            border: none;
            border-radius: 10px;
            font-weight: bold;
            display: block; /* –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –±–ª–æ—á–Ω–æ–π, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –µ–µ –ø–æ–¥ –º–µ–Ω—é */
            margin: 20px auto; /* –¶–µ–Ω—Ç—Ä—É–µ–º –∫–Ω–æ–ø–∫—É */
        }


        /* –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è –¥–ª—è —Ñ–æ–Ω–∞ */
        #overlay 
        {
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            position: fixed; /* –§–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
            z-index: 999; /* –õ–µ–∂–∏—Ç –ø–æ–¥ –æ–∫–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–∞ */
        }
       
        .shop-item {
    border: 1px solid yellow;
    background-color: white;
    border-radius: 10px;
    padding: 5px;
    text-align: center;
    width: 50px;
    height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.shop-item img {
    width: 90%;
    height: auto;
    max-height: 40px;
    object-fit: contain; /* –ß—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ—â–∞–ª–æ—Å—å */
    border-radius: 5px; /* –õ–µ–≥–∫–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
    margin-bottom: 2px;
}

.shop-item p {
    font-size: 10px;
    margin: 0;
    color: #333;
}

/* –î–ª—è —Ñ–æ–Ω–æ–≤ –¥–µ–ª–∞–µ–º –ø—Ä–µ–≤—å—é-–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ */
.background-item img {
    width: 100%;
    height: 40px;
    object-fit: cover; /* –û–±—Ä–µ–∑–∞–µ–º —Ñ–æ–Ω –ø–æ —Ä–∞–∑–º–µ—Ä—É */
    border-radius: 5px;
    border: 1px solid #ddd;
}

.shop-item:hover img {
    transform: scale(1.1);
}

.shop-item.selected img {
    border-color: #ffd700;
}


#backgroundsTab .shop-item {
    aspect-ratio: 1; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é —Ñ–æ—Ä–º—É */
}

#backgroundsTab img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.tabs {
    display: flex;
    margin-bottom: -1px; /* –ü–µ—Ä–µ–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    position: relative;
    z-index: 1;
}

.tab-button {
    padding: 8px 20px;
    background: #6EC6E3;
    border: 2px solid yellow;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    cursor: pointer;
    color: white;
    position: relative;
    transition: all 0.3s ease;
    z-index: 1;
    margin-right: 5px;
    transform: translateY(2px);
}

.tab-button.active {
    background: rgba(255, 255, 255, 0.9); /* –¶–≤–µ—Ç –∫–∞–∫ —É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    border-color: yellow;
    color: #333;
    z-index: 2;
    transform: translateY(0);
    box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
}

.tab-content {
    display: none;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    border-radius: 0 10px 10px 10px;
    padding: 15px;
    position: relative;
    z-index: 0;
}

.tab-content.active {
    display: block;
}

.background-item.selected {
    border-color: #ffd700;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ */
#shopBtn.shop-icon-button {
    width: 50px;
    height: 50px;
    background: url('shop-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#shopBtn.shop-icon-button:active {
    transform: scale(0.95);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
.icon-buttons-row {
    display: flex;
    gap: 20px;
    margin: 15px 0;
    justify-content: center;
    width: 100%;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
#statsBtn.stats-icon-button {
    width: 50px;
    height: 50px;
    background: url('stats-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#statsBtn.stats-icon-button:active {
    transform: scale(0.95);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
/* –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –ø–∞–Ω–µ–ª–µ–π */
#statsPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.stats-content {
    text-align: left;
    margin: 15px 0;
}

.stats-item {
    font-size: 18px;
    margin: 10px 0;
    color: #333;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
#infoBtn.info-icon-button {
    width: 50px;
    height: 50px;
    background: url('info-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#infoBtn.info-icon-button:active {
    transform: scale(0.95);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
#infoPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.info-content {
    text-align: left;
    margin: 15px 0;
}

.info-item {
    font-size: 16px;
    margin: 12px 0;
    color: #333;
    line-height: 1.4;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –ø–æ–∫—É–ø–∫–∏ –º–æ–Ω–µ—Ç */
#coinsPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.shop-buttons-row {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    gap: 10px;
}

.coin-package {
    width: 100%;
    margin: 8px 0;
    font-size: 16px;
    background-color: #ffd700;
    color: #333;
    text-shadow: none;
}

.coin-package:hover {
    background-color: #ffdf4d;
}

    </style>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <canvas id="gameCanvas" style="width: 100%; height: auto;"></canvas>


<div id="mainMenu">
    <h1>Flappy Bird</h1>
    <div id="coinDisplay" style="color: rgb(0, 0, 0); font-size: 20px; margin-top: 10px; margin-bottom: 10px;">0 üí∞</div>
    <div class="button-container">
        <button id="easyBtn" class="button">–õ–µ–≥–∫–æ</button>
        <button id="mediumBtn" class="button">–°—Ä–µ–¥–Ω–µ</button>
        <button id="hardBtn" class="button">–°–ª–æ–∂–Ω–æ</button>
        <div class="icon-buttons-row">
            <button id="shopBtn" class="shop-icon-button"></button>
            <button id="statsBtn" class="stats-icon-button"></button>
            <button id="infoBtn" class="info-icon-button"></button>
        </div>
        <button id="earnButton" class="button">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100 –º–æ–Ω–µ—Ç</button>
    </div>
</div>

<!-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ statsPanel -->
<div id="coinsPanel" style="display:none;">
    <h2>–ö—É–ø–∏—Ç—å:</h2>
    <div class="button-container">
        <button class="coin-package button" data-coins="100" data-price="10">100 üí∞ - 10 –≥–æ–ª–æ—Å–æ–≤</button>
        <button class="coin-package button" data-coins="300" data-price="20">300 üí∞ - 20 –≥–æ–ª–æ—Å–æ–≤</button>
        <button class="coin-package button" data-coins="500" data-price="30">500 üí∞ - 30 –≥–æ–ª–æ—Å–æ–≤</button>
        <button class="coin-package button" data-coins="1000" data-price="50">1000 üí∞ - 50 –≥–æ–ª–æ—Å–æ–≤</button>
    </div>
    <button id="closeCoinsBtn" class="button">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ù–æ–≤–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<div id="infoPanel" style="display:none;">
    <h2>–û –∏–≥—Ä–µ</h2>
    <div class="info-content">
        <p>–ù–∞–≥—Ä–∞–¥—ã –∑–∞ —É—Ä–æ–≤–Ω–∏:</p>
        <div class="info-item">üéÆ –õ–µ–≥–∫–∏–π: 1 –º–æ–Ω–µ—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–µ 15 —Ç—Ä—É–±</div>
        <div class="info-item">üéÆ –°—Ä–µ–¥–Ω–∏–π: 1 –º–æ–Ω–µ—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–µ 10 —Ç—Ä—É–±</div>
        <div class="info-item">üéÆ –°–ª–æ–∂–Ω—ã–π: 1 –º–æ–Ω–µ—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–µ 5 —Ç—Ä—É–±</div>
    </div>
    <button id="closeInfoBtn" class="button">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ù–æ–≤–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<!-- –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ç–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div id="statsPanel" style="display:none;">
    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div class="stats-content">
        <p style="margin: 0 0 15px 0; font-weight: bold;">–†–µ–∫–æ—Ä–¥—ã:</p>
        <div class="stats-item">–õ–µ–≥–∫–∏–π: <span id="easyStats">0</span></div>
        <div class="stats-item">–°—Ä–µ–¥–Ω–∏–π: <span id="mediumStats">0</span></div>
        <div class="stats-item">–°–ª–æ–∂–Ω—ã–π: <span id="hardStats">0</span></div>
    </div>
    <button id="closeStatsBtn" class="button" style="margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –û–∫–Ω–æ –º–∞–≥–∞–∑–∏–Ω–∞ -->
<div id="shopPanel" style="display:none;">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="tabs">
        <button class="tab-button active" data-tab="birds">–ü—Ç–∏—á–∫–∏</button>
        <button class="tab-button" data-tab="backgrounds">–§–æ–Ω—ã</button>
    </div>

    <div id="birdsTab" class="tab-content active">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
        <div class="shop-item" data-index="0" data-cost="0">
            <img src="bird0.png" alt="–ü—Ç–∏—á–∫–∞" />
            <p>‚úî</p>
        </div>
        <div class="shop-item" data-index="1" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="2" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="3" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="4" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="5" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="6" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="7" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="8" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="9" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="10" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        <div class="shop-item" data-index="11" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 üí∞</p>
        </div>
        </div>
    </div>
    <!-- –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ —Å —Ñ–æ–Ω–∞–º–∏ -->
    
    <div id="backgroundsTab" class="tab-content">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
            <div class="shop-item background-item" data-index="0" data-cost="0">
                <img src="background.png" alt="–ë–∞–∑–æ–≤—ã–π —Ñ–æ–Ω">
                <p>‚úî</p>
            </div>
            <div class="shop-item background-item" data-index="1" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div>
            <div class="shop-item background-item" data-index="2" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="3" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="4" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="5" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="6" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="7" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="8" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="9" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div><div class="shop-item background-item" data-index="10" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div>
            <div class="shop-item background-item" data-index="11" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 üí∞</p>
            </div>
        </div>
    </div>
    <div class="shop-buttons-row">
        <button id="coinsBtn" class="button">–ú–æ–Ω–µ—Ç—ã</button>
        <button id="closeShopBtn" class="button">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="gameOverPanel" style="display:none;">
    <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h2>
    <p>–í–∞—à —Å—á–µ—Ç: <span id="scoreDisplay"></span></p>
    <p>–†–µ–∫–æ—Ä–¥: <span id="highScoreDisplay"></span></p>
    <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã: <span id="coinsDisplay"></span></p> <!-- –≠—Ç–æ —Å—Ç—Ä–æ–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–Ω–µ—Ç -->
    <div style="display: flex; justify-content: center; gap: 10px;"> <!-- Flexbox –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–∏ -->
        <button id="restartBtn" class="button" style="width: 120px;">&#8635</button> <!-- –£–∫–∞–∑—ã–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –∫–Ω–æ–ø–∫–∏ -->
        <button id="menuBtn" class="button" style="width: 120px;">–ú–µ–Ω—é</button>
    </div>
    <button id="shareBtn" class="button" style="width: 120px;">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
</div>

<div class="pause-text" id="pauseText" style="display: none;">–ü–∞—É–∑–∞</div>

<div id="popup" class="popup">
    <div class="popup-content">
        <span class="close" id="closePopup">&times;</span>
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ</h2>
        <p>–≠—Ç–æ –ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã Flappy Bird.</p>
        <button id="confirm" class="button">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>

// –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–æ
let vkUser = null;
const APP_ID = 53524708; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è


// –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞
if (window.location.hash) {
    const params = new URLSearchParams(window.location.hash.substr(1));
    if (params.has('vk_user_id')) {
        localStorage.setItem('vkParams', JSON.stringify(Object.fromEntries(params.entries())));
    }
}
const launchParams = new URLSearchParams(window.location.hash.slice(1));
let vkUserId = launchParams.get('vk_user_id');
const vkAccessToken = launchParams.get('vk_access_token');
const vkAppId = launchParams.get('vk_app_id');
const vkIsAppUser = launchParams.get('vk_is_app_user');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
vkBridge.send('VKWebAppInit', {})
    .then(async () => {
        console.log('VK Bridge initialized');
        await vkBridge.send('VKWebAppCheckNativeAds', { ad_format: 'reward' });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if (vkIsAppUser === '1') {
            await checkAuthOnLoad();
        }
    })
    .catch(err => console.error('VK init error:', err));



// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
// –ó–∞–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é checkAuthOnLoad
async function checkAuthOnLoad() {
    try {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã VK
        if (vkUserId && vkAccessToken) {
            await validateSignature(launchParams);
            const user = await vkBridge.send('VKWebAppGetUserInfo');
            vkUser = user;
            await loadGameProgress();
            return;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            updateCoinDisplay();
            drawBackground();
        }

        // –†–µ–∑–µ—Ä–≤–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        const user = await vkBridge.send('VKWebAppGetUserInfo');
        vkUser = user;
        await loadGameProgress();
        
    } catch (err) {
        console.log('Auto-auth failed:', err);
        // –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º
        vkUserId = 'guest_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('vkUserId', vkUserId);
    }

}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
async function validateSignature(params) {
    const sign = params.get('sign');
    const checkParams = Object.fromEntries(
        Array.from(params).filter(([key]) => key !== 'sign')
    );
    
    const isValid = await vkBridge.send('VKWebAppVerifyMessage', {
        message: new URLSearchParams(checkParams).toString(),
        signature: sign
    });

    return isValid;
}

// –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
async function saveGameProgress() {
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–∞—Ö
    const unlockedBirds = Array.from(document.querySelectorAll('#birdsTab .shop-item'))
        .filter(item => parseInt(item.dataset.cost) === 0)
        .map(item => parseInt(item.dataset.index));

    const unlockedBackgrounds = Array.from(document.querySelectorAll('#backgroundsTab .shop-item'))
        .filter(item => parseInt(item.dataset.cost) === 0)
        .map(item => parseInt(item.dataset.index));

    const data = {
        highScores,
        totalCoins,
        selectedBirdIndex,
        selectedBackgroundIndex,
        unlockedBirds,
        unlockedBackgrounds,
        timestamp: Date.now()
    };

    const storageKey = `flappy_save_${vkUserId}`;
    
    try {
        await vkBridge.send('VKWebAppStorageSet', {
            key: storageKey,
            value: JSON.stringify(data)
        });
    } catch (err) {
        localStorage.setItem(storageKey, JSON.stringify(data));
    }
}

async function loadGameProgress() {
    const storageKey = `flappy_save_${vkUserId}`;
    
    try {
        const response = await vkBridge.send('VKWebAppStorageGet', {keys: [storageKey]});
        let data = response.keys[0]?.value ? JSON.parse(response.keys[0].value) : null;

        if (!data) {
            const localData = localStorage.getItem(storageKey);
            data = localData ? JSON.parse(localData) : null;
        }

        if (data) {
            // –Ø–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            highScores = data.highScores || {easy:0, medium:0, hard:0};
            totalCoins = data.totalCoins || 0;
            selectedBirdIndex = data.selectedBirdIndex || 0;
            selectedBackgroundIndex = data.selectedBackgroundIndex || 0;

            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
            updateShopItems(data);
            return true;
        }
        return false;
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
        return false;
    }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
function updateShopItems(data) {
    // –î–ª—è –ø—Ç–∏—á–µ–∫
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const isUnlocked = data.unlockedBirds?.includes(index) || index === 0;
        
        if (isUnlocked) {
            item.dataset.cost = '0';
            item.querySelector('img').src = `bird${index}.png`;
            item.querySelector('p').innerText = index === data.selectedBirdIndex ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
        }
    });

    // –î–ª—è —Ñ–æ–Ω–æ–≤
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const isUnlocked = data.unlockedBackgrounds?.includes(index) || index === 0;
        
        if (isUnlocked) {
            item.dataset.cost = '0';
            item.querySelector('img').src = `background${index}.png`;
            item.querySelector('p').innerText = index === data.selectedBackgroundIndex ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
        }
    });
}

function updateProgress(data) {
    highScores = data.highScores || {easy:0, medium:0, hard:0};
    totalCoins = data.totalCoins || 0;
    selectedBirdIndex = data.selectedBirdIndex || 0;
    selectedBackgroundIndex = data.selectedBackgroundIndex || 0;

    // –î–ª—è –ø—Ç–∏—á–µ–∫
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const cost = parseInt(item.dataset.cost || 0);
        
        if (cost === 0) {
            item.querySelector('p').innerText = index === selectedBirdIndex ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
            item.querySelector('img').src = `bird${index}.png`;
        }
    });

    // –î–ª—è —Ñ–æ–Ω–æ–≤
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const cost = parseInt(item.dataset.cost || 0);
        
        if (cost === 0) {
            item.querySelector('p').innerText = index === selectedBackgroundIndex ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
            item.querySelector('img').src = `background${index}.png`;
        }
    });
    
    document.getElementById('coinsValue').textContent = totalCoins;
    updateCoinDisplay();
    drawBackground();
    updateStatsDisplay(); 
}

// –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
document.getElementById('shareBtn').addEventListener('click', () => {
    const shareText = `–Ø –Ω–∞–±—Ä–∞–ª ${score} –æ—á–∫–æ–≤ –≤ Flappy Bird! –ü–æ–ø—Ä–æ–±—É–π –ø–æ–±–µ–¥–∏—Ç—å –º–µ–Ω—è!`;
    
    vkBridge.send('VKWebAppShare', {
        link: 'https://vk.com/app1234567', // –í–∞—à–∞ —Å—Å—ã–ª–∫–∞
        title: 'Flappy Bird',
        text: shareText
    }).catch(err => alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + err.message));
});


// –í –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞
let selectedBackgroundIndex = 0;
const backgroundImages = Array(12).fill().map((_, i) => {
    const img = new Image();
    img.src = i === 0 ? 'background.png' : `background${i}.png`;
    return img;
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
        document.querySelectorAll('.tab-button, .tab-content').forEach(el => {
            el.classList.remove('active');
        });
        button.classList.add('active');
        document.getElementById(`${button.dataset.tab}Tab`).classList.add('active');
    });
});

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
document.querySelectorAll('.shop-item').forEach(item => {
    item.addEventListener('click', function() {
        const index = parseInt(this.dataset.index);
        const cost = parseInt(this.dataset.cost || 0);
        
        if (this.closest('#birdsTab')) {
            handleBird(index, cost, this);
        } else if (this.closest('#backgroundsTab')) {
            handleBackground(index, cost, this);
        }
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ–Ω–æ–≤
function handleBackground(index, cost, element) {
    if (cost > 0) {
        if (totalCoins >= cost) {
            totalCoins -= cost;
            element.dataset.cost = '0';
            element.querySelector('img').src = `background${index}.png`;
            element.querySelector('p').innerText = '–í—ã–±—Ä–∞—Ç—å';
            updateCoinDisplay();
        }
        return;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–æ–Ω—ã
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const itemCost = parseInt(item.dataset.cost || 0);
        if (itemCost === 0) {
            item.querySelector('p').innerText = item === element ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
        }
    });
    
    selectedBackgroundIndex = index;
    saveGameProgress();
    drawBackground(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω —Å—Ä–∞–∑—É
}

function handleBird(index, cost, element) {
    if (cost > 0) {
        if (totalCoins >= cost) {
            totalCoins -= cost;
            element.dataset.cost = '0';
            element.querySelector('img').src = `bird${index}.png`;
            element.querySelector('p').innerText = '–í—ã–±—Ä–∞—Ç—å';
            updateCoinDisplay();
        }
        return;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ç–∏—á–∫–∏
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const itemCost = parseInt(item.dataset.cost || 0);
        if (itemCost === 0) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–∫—Ä—ã—Ç –ª–∏ –ø—Ä–µ–¥–º–µ—Ç
            item.querySelector('p').innerText = item === element ? '‚úî' : '–í—ã–±—Ä–∞—Ç—å';
        }
    });
    
    selectedBirdIndex = index;
    saveGameProgress();
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
document.addEventListener('selectstart', function(e) {
        e.preventDefault();
        return false;
    });

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    });

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑—É–º–∞ –∂–µ—Å—Ç–∞–º–∏
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
    document.addEventListener('wheel', function(e) {
        e.preventDefault();
    }, { passive: false });

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ –∫–∞—Å–∞–Ω–∏–µ–º
    document.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, { passive: false });

let lastTime = 0;
let deltaTime = 0;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const PIPE_WIDTH = 30; // –®–∏—Ä–∏–Ω–∞ —Ç—Ä—É–±
const GAP = 150; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –≤–µ—Ä—Ö–Ω–µ–π –∏ –Ω–∏–∂–Ω–µ–π —Ç—Ä—É–±–æ–π

const SPEED_EASY = 4;  // –°–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è
const SPEED_MEDIUM = 6;  // –°–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
const SPEED_HARD = 7;  // –°–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

let pipeSpeed = SPEED_EASY; // –ù–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

const GAP_EASY = 250;   // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è
const GAP_MEDIUM = 200; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
const GAP_HARD = 200;    // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

let totalCoins = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç
let selectedBirdIndex = 0; // –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ç–∏—á–∫–∏
const shopItems = document.querySelectorAll('.shop-item');
let coinsEarned = 0; // –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∑–∞ —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É

canvas.width = 400; // –®–∏—Ä–∏–Ω–∞ –∫–∞–Ω–≤–∞—Å–∞
canvas.height = 600; // –í—ã—Å–æ—Ç–∞ –∫–∞–Ω–≤–∞—Å–∞

let gap = GAP_EASY; // –ù–∞—á–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ

// –ó–∞–º–µ–Ω–∏—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –ø—Ç–∏—á–∫–∏
const BIRD_PHYSICS = {
    GRAVITY: 0.8,     // –°–∏–ª–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ (–±—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ)
    LIFT: -12,        // –°–∏–ª–∞ –ø—Ä—ã–∂–∫–∞ (—Ä–µ–∑–∫–∏–π –ø–æ–¥—ä–µ–º)
    ROTATION_RANGE: {  // –£–≥–ª—ã –ø–æ–≤–æ—Ä–æ—Ç–∞ –ø—Ç–∏—á–∫–∏
        MIN: -Math.PI/6,  // -30¬∞
        MAX: Math.PI/2    // 90¬∞
    },
    ROTATION_SPEED: 0.15  // –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è
};

let bird = {
    x: 50,
    y: 150,
    width: 40,
    height: 30,
    gravity: BIRD_PHYSICS.GRAVITY,
    lift: BIRD_PHYSICS.LIFT,
    velocity: 0,
    angle: 0,
    rotationSpeed: BIRD_PHYSICS.ROTATION_SPEED
};

    let pipes = [];
    let score = 0;
    let highScores = {
    easy: 0,
    medium: 0,
    hard: 0
};

// –ò –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
let currentDifficulty = 'easy';
    let isGameOver = false;
    let isPaused = false;

const birdImages = Array(12).fill().map((_, i) => {
    const img = new Image();
    img.src = `bird${i}.png`;
    return img;
});


    const backgroundImage = new Image();
    backgroundImage.src = 'background.png';

function drawBackground() {
    const bgIndex = Math.min(selectedBackgroundIndex, backgroundImages.length - 1);
    ctx.drawImage(backgroundImages[bgIndex], 0, 0, canvas.width, canvas.height);
}

// –í —Å–µ–∫—Ü–∏–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
const HOLE_MOVEMENT = {
  SPEED: 1,    // –°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ä—Å—Ç–∏—è
  RANGE: 80      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
};

// –í —Ñ—É–Ω–∫—Ü–∏–∏ addPipe()
function addPipe() {
    const baseY = Math.random() * (canvas.height - gap - 100) + 50;
    pipes.push({
        baseY: baseY, // –§–∏–∫—Å–∏—Ä—É–µ–º –±–∞–∑–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
        offsetY: 0,
        direction: Math.random() < 0.5 ? 1 : -1, // –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        top: {
            x: canvas.width,
            y: 0,
            width: PIPE_WIDTH,
            height: baseY
        },
        bottom: {
            x: canvas.width,
            y: baseY + gap,
            width: PIPE_WIDTH,
            height: canvas.height - (baseY + gap)
        }
    });
}

    function drawBird() 
    {
        ctx.save(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ canvas
        ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2); // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ü–µ–Ω—Ç—Ä –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è
        ctx.rotate(bird.angle); // –í—Ä–∞—â–∞–µ–º canvas –ø–æ —É–≥–ª—É –ø—Ç–∏—á–∫–∏

        ctx.drawImage(birdImages[selectedBirdIndex], -bird.width / 2, -bird.height / 2, bird.width, bird.height); // –†–∏—Å—É–µ–º –ø—Ç–∏—á–∫—É
        ctx.restore(); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º canvas
    }

    const TIP_WIDTH = 40; // –®–∏—Ä–∏–Ω–∞ –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫–æ–≤
    const RADIUS = 5; // –†–∞–¥–∏—É—Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–∏—è

    function drawPipes() 
    {
        pipes.forEach(pipe => {
            ctx.fillStyle = 'green';
            ctx.fillRect(pipe.top.x, pipe.top.y, PIPE_WIDTH, pipe.top.height);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(pipe.top.x, pipe.top.y, PIPE_WIDTH, pipe.top.height);
            ctx.fillStyle = 'green';
            drawRoundedRect(pipe.top.x + (PIPE_WIDTH - TIP_WIDTH) / 2, pipe.top.y + pipe.top.height - 20, TIP_WIDTH, 20, RADIUS);
            ctx.fillRect(pipe.bottom.x, pipe.bottom.y, PIPE_WIDTH, pipe.bottom.height);
            ctx.strokeRect(pipe.bottom.x, pipe.bottom.y, PIPE_WIDTH, pipe.bottom.height);
            ctx.fillStyle = 'green';
            drawRoundedRect(pipe.bottom.x + (PIPE_WIDTH - TIP_WIDTH) / 2, pipe.bottom.y, TIP_WIDTH, 20, RADIUS);
        });
    }

    function drawRoundedRect(x, y, width, height, radius) 
    {
        ctx.fillStyle = 'green';
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;

        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
    }

let pipeTimer = 0;

function update(dt) {
    if (isPaused) return;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏ –ø—Ç–∏—Ü—ã
    bird.velocity += bird.gravity * dt * 60;
    bird.y += bird.velocity * dt * 60;
    bird.angle = Math.min(Math.max(bird.velocity / 10, -Math.PI/4), Math.PI/2);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ç—Ä—É–±
    pipes.forEach((pipe, index) => {
        // –î–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è —Ç–æ–ª—å–∫–æ –≤ —Å–ª–æ–∂–Ω–æ–º —Ä–µ–∂–∏–º–µ
        if (pipeSpeed === SPEED_HARD) {
    pipe.offsetY += HOLE_MOVEMENT.SPEED * pipe.direction * dt * 60;
    
    // –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤
    if (Math.abs(pipe.offsetY) > HOLE_MOVEMENT.RANGE) {
        pipe.direction *= -1;
        // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É offsetY
    }
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    pipe.offsetY = Math.max(-HOLE_MOVEMENT.RANGE, 
        Math.min(HOLE_MOVEMENT.RANGE, pipe.offsetY));
    
    // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏
    pipe.top.height = pipe.baseY + pipe.offsetY;
    pipe.bottom.y = pipe.top.height + gap;
    pipe.bottom.height = canvas.height - pipe.bottom.y;
}

        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Ç—Ä—É–±
        pipe.top.x -= pipeSpeed * dt * 60;
        pipe.bottom.x -= pipeSpeed * dt * 60;

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä—É–±, –≤—ã—à–µ–¥—à–∏—Ö –∑–∞ –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
        if (pipe.top.x + PIPE_WIDTH < 0) {
            pipes.splice(index, 1);
            score++;
            updateCoins();
        }
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π —Å –∫–∞–∂–¥–æ–π —Ç—Ä—É–±–æ–π
    pipes.forEach(pipe => {
        if (checkCollision(pipe)) {
            endGame();
        }
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∑–µ–º–ª–µ–π
    if (bird.y + bird.height >= canvas.height) {
        endGame();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ç—Ä—É–±
    pipeTimer += dt;
    const spawnInterval = 5 / pipeSpeed;
    if (pipeTimer >= spawnInterval) {
        addPipe();
        pipeTimer = 0;
    }
}
// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–ª–∏–∑–∏–π
function checkCollision(pipe) {
    const birdRight = bird.x + bird.width;
    const birdBottom = bird.y + bird.height;
    const pipeRight = pipe.top.x + PIPE_WIDTH;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è
    if (birdRight < pipe.top.x || bird.x > pipeRight) {
        return false;
    }
    
    // –í–µ—Ä—Ö–Ω—è—è —Ç—Ä—É–±–∞
    const topPipeBottom = pipe.top.y + pipe.top.height;
    if (bird.y < topPipeBottom) {
        return true;
    }
    
    // –ù–∏–∂–Ω—è—è —Ç—Ä—É–±–∞
    const bottomPipeTop = pipe.bottom.y;
    if (birdBottom > bottomPipeTop) {
        return true;
    }
    
    return false;
}

function endGame() {
    isGameOver = true;
    totalCoins += coinsEarned;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    if (score > highScores[currentDifficulty]) {
        highScores[currentDifficulty] = score;
    }
    
    saveGameProgress();
    updateLeaderboard();
    
    document.getElementById('scoreDisplay').innerText = score;
    document.getElementById('highScoreDisplay').innerText = highScores[currentDifficulty];
    document.getElementById('coinsDisplay').innerText = `+${coinsEarned} üí∞`;
    document.getElementById('gameOverPanel').style.display = 'block';
}
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawBird();
            drawPipes();
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeText(`–°—á–µ—Ç: ${score}`, 10, 25);
            ctx.fillText(`–°—á–µ—Ç: ${score}`, 10, 25);
            
            if (isPaused) {
                document.getElementById('pauseText').style.display = 'block';
            } else {
                document.getElementById('pauseText').style.display = 'none';
            }
        }

        function updateCoins() {
    if (isGameOver) return;

    if (score % levelCoinThreshold() === 0 && score > 0) {
        coinsEarned++;
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–Ω–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
        updateCoinDisplay();
    }
}  

        function levelCoinThreshold() {
            switch (pipeSpeed) {
                case SPEED_EASY:
                    return 15; // –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç—Ä—É–±—ã –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è
                case SPEED_MEDIUM:
                    return 10; // –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç—Ä—É–±—ã –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
                case SPEED_HARD:
                    return 5;  // –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç—Ä—É–±—ã –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
                default:
                    return 15; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
        }

        function updateCoinDisplay() {
        document.getElementById('coinDisplay').innerText = `${totalCoins} üí∞`;
    }



     // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ç–∏—á–∫–∏
     function setSelectedBird(index) {
        shopItems[selectedBirdIndex].querySelector('p').innerText = '–í—ã–±—Ä–∞—Ç—å'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ä–æ–π –ø—Ç–∏—á–∫–∏
        selectedBirdIndex = index; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
        shopItems[selectedBirdIndex].querySelector('p').innerText = '‚úî'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–∞–ª–æ—á–∫—É –ø–æ–¥ –Ω–æ–≤–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ç–∏—á–∫–æ–π
    }

    // –ü—Ä–∏–º–µ—Ä –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–æ–Ω–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à—É –ª–æ–≥–∏–∫—É –∑–¥–µ—Å—å)
    function earnCoins(amount) {
        totalCoins += amount;
        updateCoinDisplay();
    }

    function gameLoop(timestamp) {
    if (isGameOver) return;
    
    if (!lastTime) lastTime = timestamp;
    deltaTime = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    update(deltaTime);
    draw();
    requestAnimationFrame(gameLoop); // –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
}

    document.addEventListener('keydown', (event) => {
        if (event.key === 'p') {
            isPaused = !isPaused;
            if (!isPaused && !isGameOver) {
                gameLoop();
            }
        }
        if (!isGameOver && !isPaused && event.key === ' ') { 
            bird.velocity = bird.lift; 
        }
    });

document.getElementById('easyBtn').addEventListener('click', () => {
    currentDifficulty = 'easy';
    startGame(SPEED_EASY);
});

document.getElementById('mediumBtn').addEventListener('click', () => {
    currentDifficulty = 'medium';
    startGame(SPEED_MEDIUM);
});

document.getElementById('hardBtn').addEventListener('click', () => {
    currentDifficulty = 'hard';
    startGame(SPEED_HARD);
});

function startGame(speed) {
    // –°–±—Ä–æ—Å –∏–≥—Ä–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    pipes = [];
    score = 0;
    coinsEarned = 0;
    bird.y = canvas.height / 2;
    bird.velocity = 0;
    bird.angle = 0;
    isGameOver = false;
    isPaused = false;
    pipeTimer = 0;
    lastTime = 0;
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    pipeSpeed = speed;
    switch (speed) {
        case SPEED_EASY:
            gap = GAP_EASY;
            HOLE_MOVEMENT.SPEED = 0; // –û—Ç–∫–ª—é—á–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π
            break;
        case SPEED_MEDIUM:
            gap = GAP_MEDIUM;
            HOLE_MOVEMENT.SPEED = 0; // –û—Ç–∫–ª—é—á–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π
            break;
        case SPEED_HARD:
            gap = GAP_HARD;
            HOLE_MOVEMENT.SPEED = 1.5; // –í–∫–ª—é—á–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π
            break;
    }
    
    
    // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('gameOverPanel').style.display = 'none';
    document.getElementById('pauseText').style.display = 'none';
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –ø–∞—Ä—É —Ç—Ä—É–±
    addPipe();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    requestAnimationFrame(gameLoop);
}



function resetGame() {
    lastTime = 0;
    deltaTime = 0;
    pipeTimer = 0;
    pipes = [];
    score = 0;
    bird.y = 150;
    bird.velocity = 0;
    bird.angle = 0;
    isGameOver = false;
    isPaused = false;
    coinsEarned = 0;
    
    document.getElementById('gameOverPanel').style.display = 'none';
    document.getElementById('pauseText').style.display = 'none';
    updateCoinDisplay();
    
    // –û—á–∏—Å—Ç–∫–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    isPaused = false; // –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    document.getElementById('pauseText').style.display = 'none';
}


function updatePanelSizes() {
    const canvasWidth = canvas.offsetWidth;
    const canvasHeight = canvas.offsetHeight;
    
    const panels = document.querySelectorAll('#mainMenu, #shopPanel');
    panels.forEach(panel => {
        panel.style.width = `${canvasWidth * 0.9}px`;
        panel.style.maxWidth = `${400 * 0.9}px`;
        panel.style.minHeight = `${canvasHeight * 0.8}px`;
    });
}

// –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–¥–æ–±–∞–≤—å—Ç–µ –≤ gameOverPanel)
async function updateLeaderboard() {
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∫–æ—Ä–¥ –∏–∑ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
        const maxScore = Math.max(highScores.easy, highScores.medium, highScores.hard);
        
        await vkBridge.send('VKWebAppSetLeaderboardScore', {
            leaderboard_id: 1, // ID –≤–∞—à–µ–≥–æ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –≤ VK
            score: maxScore
        });
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', err);
    }
}


    document.getElementById('mainMenu').style.display = 'block'; // –°–¥–µ–ª–∞—Ç—å –º–µ–Ω—é –≤–∏–¥–∏–º—ã–º

    document.getElementById('menuBtn').addEventListener('click', () => {
            saveGameProgress();
            resetGame(); // –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
            document.getElementById('gameOverPanel').style.display = 'none'; // –°–∫—Ä—ã—Ç—å —Ç–∞–±–ª–æ "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞"
            document.getElementById('mainMenu').style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        });
document.getElementById('restartBtn').addEventListener('click', () => {
    resetGame();
    document.getElementById('gameOverPanel').style.display = 'none';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    lastTime = 0;
    deltaTime = 0;
    isGameOver = false;
    isPaused = false;
    pipes = [];
    score = 0;
    bird.y = canvas.height / 2;
    bird.velocity = 0;
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ
    requestAnimationFrame(gameLoop);
});

document.getElementById('shopBtn').addEventListener('click', () => {
    document.getElementById('mainMenu').style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    document.getElementById('shopPanel').style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–∫—Ä—ã—Ç—å" –≤ –æ–∫–Ω–µ –º–∞–≥–∞–∑–∏–Ω–∞
document.getElementById('closeShopBtn').addEventListener('click', () => {
    document.getElementById('shopPanel').style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
    document.getElementById('mainMenu').style.display = 'block'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
});

// –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –≤–≤–æ–¥–∞ —É–±–µ—Ä–∏—Ç–µ –ª—é–±—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
document.addEventListener('keydown', (event) => {
    if (!isGameOver && !isPaused && (event.key === ' ' || event.key === 'ArrowUp')) {
        bird.velocity = BIRD_PHYSICS.LIFT; // –ß–∏—Å—Ç—ã–π –∏–º–ø—É–ª—å—Å –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
        bird.angle = BIRD_PHYSICS.ROTATION_RANGE.MAX; // –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö
    }
});

// –î–ª—è touch-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
document.addEventListener('touchstart', (event) => {
    event.preventDefault();
    if (!isGameOver && !isPaused) {
        bird.velocity = BIRD_PHYSICS.LIFT;
        bird.angle = BIRD_PHYSICS.ROTATION_RANGE.MAX;
    }
});

// –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100 –º–æ–Ω–µ—Ç
document.getElementById('earnButton').addEventListener('click', () => {
        earnCoins(100);
    });



    function resizeCanvas() {
    const aspectRatio = 400 / 600; // –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω (—à–∏—Ä–∏–Ω–∞ –Ω–∞ –≤—ã—Å–æ—Ç—É)
    const width = Math.min(window.innerWidth, 400); // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 400 –ø–∏–∫—Å–µ–ª–µ–π
    const height = width / aspectRatio; // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã
    canvas.style.width = `${width}px`; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –≤ CSS
    canvas.style.height = `${height}px`; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –≤ CSS
    updatePanelSizes();
}

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
function updateAuthUI(user) {
    document.getElementById('authBtn').style.display = 'none';
    document.getElementById('userBadge').style.display = 'flex';
    document.getElementById('userName').textContent = user.first_name;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
    if(user.photo_100) {
        document.getElementById('userAvatar').src = user.photo_100;
    }
}

window.addEventListener('resize', () => {
    resizeCanvas();
    updatePanelSizes();
});

// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Å–∫—Ä–∏–ø—Ç–∞
document.addEventListener('DOMContentLoaded', async () => {
    await checkAuthOnLoad();
    resizeCanvas();
    updatePanelSizes();
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    updateCoinDisplay();
    drawBackground();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
    document.getElementById('mainMenu').style.display = 'block';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
document.getElementById('statsBtn').addEventListener('click', () => {
    updateStatsDisplay();
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('statsPanel').style.display = 'block';
});

document.getElementById('closeStatsBtn').addEventListener('click', () => {
    document.getElementById('statsPanel').style.display = 'none';
    document.getElementById('mainMenu').style.display = 'block';
});

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStatsDisplay() {
    document.getElementById('easyStats').textContent = highScores.easy;
    document.getElementById('mediumStats').textContent = highScores.medium;
    document.getElementById('hardStats').textContent = highScores.hard;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
document.getElementById('infoBtn').addEventListener('click', () => {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('infoPanel').style.display = 'block';
});

document.getElementById('closeInfoBtn').addEventListener('click', () => {
    document.getElementById('infoPanel').style.display = 'none';
    document.getElementById('mainMenu').style.display = 'block';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –º–æ–Ω–µ—Ç
document.getElementById('coinsBtn').addEventListener('click', () => {
    document.getElementById('shopPanel').style.display = 'none';
    document.getElementById('coinsPanel').style.display = 'block';
});

document.getElementById('closeCoinsBtn').addEventListener('click', () => {
    document.getElementById('coinsPanel').style.display = 'none';
    document.getElementById('shopPanel').style.display = 'block';
});

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –º–æ–Ω–µ—Ç
async function buyCoins(coins, price) {
    try {
        const result = await vkBridge.send('VKWebAppShowOrderBox', {
            type: 'item', 
            item: `coins_${coins}`, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–æ–≤–∞—Ä–∞
            price: price * 100 // –¶–µ–Ω–∞ –≤ –≥–æ–ª–æ—Å–∞—Ö (—É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100)
        });

        if (result.status === 'success') {
            totalCoins += coins;
            updateCoinDisplay();
            saveGameProgress();
            alert(`–£—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ ${coins} –º–æ–Ω–µ—Ç!`);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ');
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏
document.querySelectorAll('.coin-package').forEach(button => {
    button.addEventListener('click', function() {
        const coins = parseInt(this.dataset.coins);
        const price = parseInt(this.dataset.price);
        if (confirm(`–ö—É–ø–∏—Ç—å ${coins} –º–æ–Ω–µ—Ç –∑–∞ ${price} –≥–æ–ª–æ—Å–æ–≤?`)) {
            buyCoins(coins, price);
        }
    });
});

</script>