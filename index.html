<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Bird Clone</title>
    <style>
        body 
        {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom, #87CEEB, #B0E0E6);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: none; /* Блокируем жесты касаний */
            user-select: none; /* Запрещаем выделение текста */
            -webkit-user-select: none; /* Для Safari */
            -moz-user-select: none; /* Для Firefox */
            -ms-user-select: none; /* Для старых версий IE */
        }
        canvas 
        {
            border: 2px solid #fff;
            max-width: 100%; /* Ограничиваем ширину канваса 100% от родительского элемента */
            height: auto; /* Высота будет вычисляться автоматически для сохранения пропорций */
            display: block; /* Убираем отступы внизу, чтобы канвас отображался корректно */
            margin: 0 auto; /* Центрируем канвас */
            -webkit-tap-highlight-color: transparent; /* Убираем подсветку при тапе */
            -webkit-touch-callout: none; /* Блокируем контекстное меню iOS */
        }

        #gameOverPanel, #mainMenu, #popup, #shopPanel  
        {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid yellow;
            padding: 20px;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            -webkit-tap-highlight-color: transparent; /* Убираем подсветку при тапе */
            -webkit-touch-callout: none; /* Блокируем контекстное меню iOS */
        }

        #mainMenu, #shopPanel {
    width: 80%;
    max-width: 360px; /* 90% от 400px (ширина канваса) */
    min-width: 280px;
    height: auto;
    min-height: 500px;
    padding: 2vw;
    box-sizing: border-box;
    transform: translate(-50%, -50%);
}

.button-container {
    width: 100%;
    gap: 1.5vh;
}

.button {
    width: 100%;
    padding: 1.5vh 0;
    font-size: calc(12px + 0.5vw);
}

.tabs {
    width: 100%;
}

.shop-grid {
    width: 100%;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
}

        h1 
        {
            font-size: 48px;
            color: white;
            text-shadow: 2px 2px 4px black;
            margin: 0;
        }
        .button 
        {
            margin: 10px;
            padding: 10px 20px;
            background-color: #87CEEB;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 2px black;
            transition: background-color 0.3s;
        }
        .button:hover 
        {
            background-color: #6EC6E3;
        }
        .pause-text 
        {
            font-size: 30px;
            color: red;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        .close 
        {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover 
        {
            color: red;
        }
        .button-container  
        {
            display: flex;
            flex-direction: column; /* Размещаем кнопки вертикально */
            align-items: center; /* Центрируем кнопки по горизонтали */
        }

        .button 
        {
            width: 200px; /* Установите желаемую ширину */
            margin: 10px 0; /* Вертикальный отступ между кнопками */
            padding: 10px; /* Более равномерные отступы */
        }

        .button-container 
        {
            display: flex;
            flex-direction: column; /* Размещаем кнопки вертикально */
            align-items: center; /* Центрируем кнопки по горизонтали */
        }

        /* Дополнительные стили для значка */
        .restart-button 
        {
            font-size: 20px; /* Устанавливаем размер значка */
            background: none; /* Убираем фон, если это нужно */
            border: none; /* Убираем рамку */
            color: black; /* Цвет значка */
            cursor: pointer; /* Указатель при наведении */
            padding: 0; /* Убираем отступы */
        }

        /* Стилизация кнопки "Магазин" */
        #shopBtn 
        {
            background-color: rgb(255, 0, 0); /* Цвет кнопки */
            border: none;
            border-radius: 10px;
            font-weight: bold;
            display: block; /* Делаем кнопку блочной, чтобы отобразить ее под меню */
            margin: 20px auto; /* Центруем кнопку */
        }


        /* Можно добавить стили затемнения для фона */
        #overlay 
        {
            display: none; /* Скрываем по умолчанию */
            position: fixed; /* Фиксируем на весь экран */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Затемнение */
            z-index: 999; /* Лежит под окном магазина */
        }
       
        .shop-item {
    border: 1px solid yellow;
    background-color: white;
    border-radius: 10px;
    padding: 5px;
    text-align: center;
    width: 50px;
    height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.shop-item img {
    width: 90%;
    height: auto;
    max-height: 40px;
    object-fit: contain; /* Чтобы изображение полностью помещалось */
    border-radius: 5px; /* Легкое скругление углов */
    margin-bottom: 2px;
}

.shop-item p {
    font-size: 10px;
    margin: 0;
    color: #333;
}

/* Для фонов делаем превью-прямоугольники */
.background-item img {
    width: 100%;
    height: 40px;
    object-fit: cover; /* Обрезаем фон по размеру */
    border-radius: 5px;
    border: 1px solid #ddd;
}

.shop-item:hover img {
    transform: scale(1.1);
}

.shop-item.selected img {
    border-color: #ffd700;
}


#backgroundsTab .shop-item {
    aspect-ratio: 1; /* Сохраняем квадратную форму */
}

#backgroundsTab img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.tabs {
    display: flex;
    margin-bottom: -1px; /* Перекрываем границу контента */
    position: relative;
    z-index: 1;
}

.tab-button {
    padding: 8px 20px;
    background: #6EC6E3;
    border: 2px solid yellow;
    border-bottom: none;
    border-radius: 10px 10px 0 0;
    cursor: pointer;
    color: white;
    position: relative;
    transition: all 0.3s ease;
    z-index: 1;
    margin-right: 5px;
    transform: translateY(2px);
}

.tab-button.active {
    background: rgba(255, 255, 255, 0.9); /* Цвет как у контента */
    border-color: yellow;
    color: #333;
    z-index: 2;
    transform: translateY(0);
    box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
}

.tab-content {
    display: none;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    border-radius: 0 10px 10px 10px;
    padding: 15px;
    position: relative;
    z-index: 0;
}

.tab-content.active {
    display: block;
}

.background-item.selected {
    border-color: #ffd700;
}

/* Стили для иконки магазина */
#shopBtn.shop-icon-button {
    width: 50px;
    height: 50px;
    background: url('shop-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#shopBtn.shop-icon-button:active {
    transform: scale(0.95);
}

/* Стили для строки с иконками */
.icon-buttons-row {
    display: flex;
    gap: 20px;
    margin: 15px 0;
    justify-content: center;
    width: 100%;
}

/* Стили для кнопки статистики */
#statsBtn.stats-icon-button {
    width: 50px;
    height: 50px;
    background: url('stats-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#statsBtn.stats-icon-button:active {
    transform: scale(0.95);
}

/* Стили для окна статистики */
/* Добавляем общие стили для всех панелей */
#statsPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.stats-content {
    text-align: left;
    margin: 15px 0;
}

.stats-item {
    font-size: 18px;
    margin: 10px 0;
    color: #333;
}

/* Стили для кнопки информации */
#infoBtn.info-icon-button {
    width: 50px;
    height: 50px;
    background: url('info-icon.png') no-repeat center center;
    background-size: 70%;
    border: 0px solid #ffd700;
    border-radius: 10px;
    padding: 0;
    transition: transform 0.2s;
    margin: 0;
}

#infoBtn.info-icon-button:active {
    transform: scale(0.95);
}

/* Стили для окна информации */
#infoPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.info-content {
    text-align: left;
    margin: 15px 0;
}

.info-item {
    font-size: 16px;
    margin: 12px 0;
    color: #333;
    line-height: 1.4;
}

/* Стили для панели покупки монет */
#coinsPanel {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid yellow;
    padding: 20px;
    text-align: center;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 80%;
    max-width: 300px;
    min-width: 280px;
}

.shop-buttons-row {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    gap: 10px;
}

.coin-package {
    width: 100%;
    margin: 8px 0;
    font-size: 16px;
    background-color: #ffd700;
    color: #333;
    text-shadow: none;
}

.coin-package:hover {
    background-color: #ffdf4d;
}

    </style>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <canvas id="gameCanvas" style="width: 100%; height: auto;"></canvas>


<div id="mainMenu">
    <h1>Flappy Bird</h1>
    <div id="coinDisplay" style="color: rgb(0, 0, 0); font-size: 20px; margin-top: 10px; margin-bottom: 10px;">0 💰</div>
    <div class="button-container">
        <button id="easyBtn" class="button">Легко</button>
        <button id="mediumBtn" class="button">Средне</button>
        <button id="hardBtn" class="button">Сложно</button>
        <div class="icon-buttons-row">
            <button id="shopBtn" class="shop-icon-button"></button>
            <button id="statsBtn" class="stats-icon-button"></button>
            <button id="infoBtn" class="info-icon-button"></button>
        </div>
        <button id="earnButton" class="button">Заработать 100 монет</button>
    </div>
</div>

<!-- Добавить после statsPanel -->
<div id="coinsPanel" style="display:none;">
    <h2>Купить:</h2>
    <div class="button-container">
        <button class="coin-package button" data-coins="100" data-price="10">100 💰 - 10 голосов</button>
        <button class="coin-package button" data-coins="300" data-price="20">300 💰 - 20 голосов</button>
        <button class="coin-package button" data-coins="500" data-price="30">500 💰 - 30 голосов</button>
        <button class="coin-package button" data-coins="1000" data-price="50">1000 💰 - 50 голосов</button>
    </div>
    <button id="closeCoinsBtn" class="button">Закрыть</button>
</div>

<!-- Новое окно информации -->
<div id="infoPanel" style="display:none;">
    <h2>О игре</h2>
    <div class="info-content">
        <p>Награды за уровни:</p>
        <div class="info-item">🎮 Легкий: 1 монета за каждые 15 труб</div>
        <div class="info-item">🎮 Средний: 1 монета за каждые 10 труб</div>
        <div class="info-item">🎮 Сложный: 1 монета за каждые 5 труб</div>
    </div>
    <button id="closeInfoBtn" class="button">Закрыть</button>
</div>

<!-- Новое окно статистики -->
<!-- Исправляем разметку статистики -->
<div id="statsPanel" style="display:none;">
    <h2>Статистика</h2>
    <div class="stats-content">
        <p style="margin: 0 0 15px 0; font-weight: bold;">Рекорды:</p>
        <div class="stats-item">Легкий: <span id="easyStats">0</span></div>
        <div class="stats-item">Средний: <span id="mediumStats">0</span></div>
        <div class="stats-item">Сложный: <span id="hardStats">0</span></div>
    </div>
    <button id="closeStatsBtn" class="button" style="margin-top: 15px;">Закрыть</button>
</div>

<!-- Окно магазина -->
<div id="shopPanel" style="display:none;">
    <h2>Магазин</h2>
    <div class="tabs">
        <button class="tab-button active" data-tab="birds">Птички</button>
        <button class="tab-button" data-tab="backgrounds">Фоны</button>
    </div>

    <div id="birdsTab" class="tab-content active">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
        <div class="shop-item" data-index="0" data-cost="0">
            <img src="bird0.png" alt="Птичка" />
            <p>✔</p>
        </div>
        <div class="shop-item" data-index="1" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="2" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="3" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="4" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="5" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="6" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="7" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="8" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="9" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="10" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        <div class="shop-item" data-index="11" data-cost="100">
            <img src="question.png" alt="?" />
            <p>100 💰</p>
        </div>
        </div>
    </div>
    <!-- Новая вкладка с фонами -->
    
    <div id="backgroundsTab" class="tab-content">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
            <div class="shop-item background-item" data-index="0" data-cost="0">
                <img src="background.png" alt="Базовый фон">
                <p>✔</p>
            </div>
            <div class="shop-item background-item" data-index="1" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div>
            <div class="shop-item background-item" data-index="2" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="3" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="4" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="5" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="6" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="7" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="8" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="9" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div><div class="shop-item background-item" data-index="10" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div>
            <div class="shop-item background-item" data-index="11" data-cost="100">
                <img src="question.png" alt="?">
                <p>100 💰</p>
            </div>
        </div>
    </div>
    <div class="shop-buttons-row">
        <button id="coinsBtn" class="button">Монеты</button>
        <button id="closeShopBtn" class="button">Закрыть</button>
    </div>
</div>

<div id="gameOverPanel" style="display:none;">
    <h2>Игра окончена</h2>
    <p>Ваш счет: <span id="scoreDisplay"></span></p>
    <p>Рекорд: <span id="highScoreDisplay"></span></p>
    <p>Заработанные монеты: <span id="coinsDisplay"></span></p> <!-- Это строка добавлена для отображения монет -->
    <div style="display: flex; justify-content: center; gap: 10px;"> <!-- Flexbox для центровки -->
        <button id="restartBtn" class="button" style="width: 120px;">&#8635</button> <!-- Указываем ширину кнопки -->
        <button id="menuBtn" class="button" style="width: 120px;">Меню</button>
    </div>
    <button id="shareBtn" class="button" style="width: 120px;">Поделиться</button>
</div>

<div class="pause-text" id="pauseText" style="display: none;">Пауза</div>

<div id="popup" class="popup">
    <div class="popup-content">
        <span class="close" id="closePopup">&times;</span>
        <h2>Информация об игре</h2>
        <p>Это простая версия игры Flappy Bird.</p>
        <button id="confirm" class="button">Закрыть</button>
    </div>
</div>

<script>

// Добавьте эти переменные в начало
let vkUser = null;
const APP_ID = 53524708; // Замените на ваш ID приложения


// Добавьте в самое начало скрипта
if (window.location.hash) {
    const params = new URLSearchParams(window.location.hash.substr(1));
    if (params.has('vk_user_id')) {
        localStorage.setItem('vkParams', JSON.stringify(Object.fromEntries(params.entries())));
    }
}
const launchParams = new URLSearchParams(window.location.hash.slice(1));
let vkUserId = launchParams.get('vk_user_id');
const vkAccessToken = launchParams.get('vk_access_token');
const vkAppId = launchParams.get('vk_app_id');
const vkIsAppUser = launchParams.get('vk_is_app_user');

// Инициализация VK Bridge
vkBridge.send('VKWebAppInit', {})
    .then(async () => {
        console.log('VK Bridge initialized');
        await vkBridge.send('VKWebAppCheckNativeAds', { ad_format: 'reward' });
        
        // Автоматическая авторизация если есть параметры
        if (vkIsAppUser === '1') {
            await checkAuthOnLoad();
        }
    })
    .catch(err => console.error('VK init error:', err));



// Функция проверки авторизации при загрузке
// Заменить функцию checkAuthOnLoad
async function checkAuthOnLoad() {
    try {
        // Автоматическая авторизация через параметры VK
        if (vkUserId && vkAccessToken) {
            await validateSignature(launchParams);
            const user = await vkBridge.send('VKWebAppGetUserInfo');
            vkUser = user;
            await loadGameProgress();
            return;
            // Обновляем интерфейс сразу после загрузки
            updateCoinDisplay();
            drawBackground();
        }

        // Резервная авторизация для мобильных клиентов
        const user = await vkBridge.send('VKWebAppGetUserInfo');
        vkUser = user;
        await loadGameProgress();
        
    } catch (err) {
        console.log('Auto-auth failed:', err);
        // Гостевой режим
        vkUserId = 'guest_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('vkUserId', vkUserId);
    }

}

// Проверка подписи для безопасности (обязательно!)
async function validateSignature(params) {
    const sign = params.get('sign');
    const checkParams = Object.fromEntries(
        Array.from(params).filter(([key]) => key !== 'sign')
    );
    
    const isValid = await vkBridge.send('VKWebAppVerifyMessage', {
        message: new URLSearchParams(checkParams).toString(),
        signature: sign
    });

    return isValid;
}

// Модифицированные функции сохранения/загрузки
async function saveGameProgress() {
    // Собираем данные о разблокированных предметах
    const unlockedBirds = Array.from(document.querySelectorAll('#birdsTab .shop-item'))
        .filter(item => parseInt(item.dataset.cost) === 0)
        .map(item => parseInt(item.dataset.index));

    const unlockedBackgrounds = Array.from(document.querySelectorAll('#backgroundsTab .shop-item'))
        .filter(item => parseInt(item.dataset.cost) === 0)
        .map(item => parseInt(item.dataset.index));

    const data = {
        highScores,
        totalCoins,
        selectedBirdIndex,
        selectedBackgroundIndex,
        unlockedBirds,
        unlockedBackgrounds,
        timestamp: Date.now()
    };

    const storageKey = `flappy_save_${vkUserId}`;
    
    try {
        await vkBridge.send('VKWebAppStorageSet', {
            key: storageKey,
            value: JSON.stringify(data)
        });
    } catch (err) {
        localStorage.setItem(storageKey, JSON.stringify(data));
    }
}

async function loadGameProgress() {
    const storageKey = `flappy_save_${vkUserId}`;
    
    try {
        const response = await vkBridge.send('VKWebAppStorageGet', {keys: [storageKey]});
        let data = response.keys[0]?.value ? JSON.parse(response.keys[0].value) : null;

        if (!data) {
            const localData = localStorage.getItem(storageKey);
            data = localData ? JSON.parse(localData) : null;
        }

        if (data) {
            // Явно обновляем все параметры
            highScores = data.highScores || {easy:0, medium:0, hard:0};
            totalCoins = data.totalCoins || 0;
            selectedBirdIndex = data.selectedBirdIndex || 0;
            selectedBackgroundIndex = data.selectedBackgroundIndex || 0;

            // Обновляем магазин
            updateShopItems(data);
            return true;
        }
        return false;
    } catch (err) {
        console.error('Ошибка загрузки:', err);
        return false;
    }
}

// Новая функция для обновления магазина
function updateShopItems(data) {
    // Для птичек
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const isUnlocked = data.unlockedBirds?.includes(index) || index === 0;
        
        if (isUnlocked) {
            item.dataset.cost = '0';
            item.querySelector('img').src = `bird${index}.png`;
            item.querySelector('p').innerText = index === data.selectedBirdIndex ? '✔' : 'Выбрать';
        }
    });

    // Для фонов
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const isUnlocked = data.unlockedBackgrounds?.includes(index) || index === 0;
        
        if (isUnlocked) {
            item.dataset.cost = '0';
            item.querySelector('img').src = `background${index}.png`;
            item.querySelector('p').innerText = index === data.selectedBackgroundIndex ? '✔' : 'Выбрать';
        }
    });
}

function updateProgress(data) {
    highScores = data.highScores || {easy:0, medium:0, hard:0};
    totalCoins = data.totalCoins || 0;
    selectedBirdIndex = data.selectedBirdIndex || 0;
    selectedBackgroundIndex = data.selectedBackgroundIndex || 0;

    // Для птичек
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const cost = parseInt(item.dataset.cost || 0);
        
        if (cost === 0) {
            item.querySelector('p').innerText = index === selectedBirdIndex ? '✔' : 'Выбрать';
            item.querySelector('img').src = `bird${index}.png`;
        }
    });

    // Для фонов
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const cost = parseInt(item.dataset.cost || 0);
        
        if (cost === 0) {
            item.querySelector('p').innerText = index === selectedBackgroundIndex ? '✔' : 'Выбрать';
            item.querySelector('img').src = `background${index}.png`;
        }
    });
    
    document.getElementById('coinsValue').textContent = totalCoins;
    updateCoinDisplay();
    drawBackground();
    updateStatsDisplay(); 
}

// Поделиться результатом
document.getElementById('shareBtn').addEventListener('click', () => {
    const shareText = `Я набрал ${score} очков в Flappy Bird! Попробуй победить меня!`;
    
    vkBridge.send('VKWebAppShare', {
        link: 'https://vk.com/app1234567', // Ваша ссылка
        title: 'Flappy Bird',
        text: shareText
    }).catch(err => alert('Ошибка при публикации: ' + err.message));
});


// В начало скрипта
let selectedBackgroundIndex = 0;
const backgroundImages = Array(12).fill().map((_, i) => {
    const img = new Image();
    img.src = i === 0 ? 'background.png' : `background${i}.png`;
    return img;
});

// Обработчик переключения вкладок
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
        document.querySelectorAll('.tab-button, .tab-content').forEach(el => {
            el.classList.remove('active');
        });
        button.classList.add('active');
        document.getElementById(`${button.dataset.tab}Tab`).classList.add('active');
    });
});

// Обновленный обработчик кликов для магазина
document.querySelectorAll('.shop-item').forEach(item => {
    item.addEventListener('click', function() {
        const index = parseInt(this.dataset.index);
        const cost = parseInt(this.dataset.cost || 0);
        
        if (this.closest('#birdsTab')) {
            handleBird(index, cost, this);
        } else if (this.closest('#backgroundsTab')) {
            handleBackground(index, cost, this);
        }
    });
});

// Обработчик для фонов
function handleBackground(index, cost, element) {
    if (cost > 0) {
        if (totalCoins >= cost) {
            totalCoins -= cost;
            element.dataset.cost = '0';
            element.querySelector('img').src = `background${index}.png`;
            element.querySelector('p').innerText = 'Выбрать';
            updateCoinDisplay();
        }
        return;
    }

    // Обновляем только открытые фоны
    document.querySelectorAll('#backgroundsTab .shop-item').forEach(item => {
        const itemCost = parseInt(item.dataset.cost || 0);
        if (itemCost === 0) {
            item.querySelector('p').innerText = item === element ? '✔' : 'Выбрать';
        }
    });
    
    selectedBackgroundIndex = index;
    saveGameProgress();
    drawBackground(); // Обновляем фон сразу
}

function handleBird(index, cost, element) {
    if (cost > 0) {
        if (totalCoins >= cost) {
            totalCoins -= cost;
            element.dataset.cost = '0';
            element.querySelector('img').src = `bird${index}.png`;
            element.querySelector('p').innerText = 'Выбрать';
            updateCoinDisplay();
        }
        return;
    }

    // Обновляем только открытые птички
    document.querySelectorAll('#birdsTab .shop-item').forEach(item => {
        const itemCost = parseInt(item.dataset.cost || 0);
        if (itemCost === 0) { // Проверяем открыт ли предмет
            item.querySelector('p').innerText = item === element ? '✔' : 'Выбрать';
        }
    });
    
    selectedBirdIndex = index;
    saveGameProgress();
}

// Блокировка выделения текста
document.addEventListener('selectstart', function(e) {
        e.preventDefault();
        return false;
    });

    // Блокировка контекстного меню
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    });

    // Блокировка зума жестами
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });

    // Блокировка скролла колесом мыши
    document.addEventListener('wheel', function(e) {
        e.preventDefault();
    }, { passive: false });

    // Блокировка скролла касанием
    document.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, { passive: false });

let lastTime = 0;
let deltaTime = 0;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const PIPE_WIDTH = 30; // Ширина труб
const GAP = 150; // Расстояние между верхней и нижней трубой

const SPEED_EASY = 4;  // Скорость для легкого уровня
const SPEED_MEDIUM = 6;  // Скорость для среднего уровня
const SPEED_HARD = 7;  // Скорость для сложного уровня

let pipeSpeed = SPEED_EASY; // Начальная скорость

const GAP_EASY = 250;   // Расстояние для легкого уровня
const GAP_MEDIUM = 200; // Расстояние для среднего уровня
const GAP_HARD = 200;    // Расстояние для сложного уровня

let totalCoins = 0; // Общее количество монет
let selectedBirdIndex = 0; // Индекс выбранной птички
const shopItems = document.querySelectorAll('.shop-item');
let coinsEarned = 0; // Заработанные монеты за текущую игру

canvas.width = 400; // Ширина канваса
canvas.height = 600; // Высота канваса

let gap = GAP_EASY; // Начальное расстояние

// Замените объявление констант птички
const BIRD_PHYSICS = {
    GRAVITY: 0.8,     // Сила гравитации (быстрое падение)
    LIFT: -12,        // Сила прыжка (резкий подъем)
    ROTATION_RANGE: {  // Углы поворота птички
        MIN: -Math.PI/6,  // -30°
        MAX: Math.PI/2    // 90°
    },
    ROTATION_SPEED: 0.15  // Скорость вращения
};

let bird = {
    x: 50,
    y: 150,
    width: 40,
    height: 30,
    gravity: BIRD_PHYSICS.GRAVITY,
    lift: BIRD_PHYSICS.LIFT,
    velocity: 0,
    angle: 0,
    rotationSpeed: BIRD_PHYSICS.ROTATION_SPEED
};

    let pipes = [];
    let score = 0;
    let highScores = {
    easy: 0,
    medium: 0,
    hard: 0
};

// И добавляем переменную для отслеживания текущего уровня
let currentDifficulty = 'easy';
    let isGameOver = false;
    let isPaused = false;

const birdImages = Array(12).fill().map((_, i) => {
    const img = new Image();
    img.src = `bird${i}.png`;
    return img;
});


    const backgroundImage = new Image();
    backgroundImage.src = 'background.png';

function drawBackground() {
    const bgIndex = Math.min(selectedBackgroundIndex, backgroundImages.length - 1);
    ctx.drawImage(backgroundImages[bgIndex], 0, 0, canvas.width, canvas.height);
}

// В секции констант
const HOLE_MOVEMENT = {
  SPEED: 1,    // Скорость движения отверстия
  RANGE: 80      // Максимальное смещение в пикселях
};

// В функции addPipe()
function addPipe() {
    const baseY = Math.random() * (canvas.height - gap - 100) + 50;
    pipes.push({
        baseY: baseY, // Фиксируем базовую позицию при создании
        offsetY: 0,
        direction: Math.random() < 0.5 ? 1 : -1, // Случайное начальное направление
        top: {
            x: canvas.width,
            y: 0,
            width: PIPE_WIDTH,
            height: baseY
        },
        bottom: {
            x: canvas.width,
            y: baseY + gap,
            width: PIPE_WIDTH,
            height: canvas.height - (baseY + gap)
        }
    });
}

    function drawBird() 
    {
        ctx.save(); // Сохраняем состояние canvas
        ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2); // Перемещаем центр для вращения
        ctx.rotate(bird.angle); // Вращаем canvas по углу птички

        ctx.drawImage(birdImages[selectedBirdIndex], -bird.width / 2, -bird.height / 2, bird.width, bird.height); // Рисуем птичку
        ctx.restore(); // Восстанавливаем canvas
    }

    const TIP_WIDTH = 40; // Ширина наконечников
    const RADIUS = 5; // Радиус закругления

    function drawPipes() 
    {
        pipes.forEach(pipe => {
            ctx.fillStyle = 'green';
            ctx.fillRect(pipe.top.x, pipe.top.y, PIPE_WIDTH, pipe.top.height);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(pipe.top.x, pipe.top.y, PIPE_WIDTH, pipe.top.height);
            ctx.fillStyle = 'green';
            drawRoundedRect(pipe.top.x + (PIPE_WIDTH - TIP_WIDTH) / 2, pipe.top.y + pipe.top.height - 20, TIP_WIDTH, 20, RADIUS);
            ctx.fillRect(pipe.bottom.x, pipe.bottom.y, PIPE_WIDTH, pipe.bottom.height);
            ctx.strokeRect(pipe.bottom.x, pipe.bottom.y, PIPE_WIDTH, pipe.bottom.height);
            ctx.fillStyle = 'green';
            drawRoundedRect(pipe.bottom.x + (PIPE_WIDTH - TIP_WIDTH) / 2, pipe.bottom.y, TIP_WIDTH, 20, RADIUS);
        });
    }

    function drawRoundedRect(x, y, width, height, radius) 
    {
        ctx.fillStyle = 'green';
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;

        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        ctx.lineTo(x + radius, y + height);
        ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
    }

let pipeTimer = 0;

function update(dt) {
    if (isPaused) return;

    // Обновление физики птицы
    bird.velocity += bird.gravity * dt * 60;
    bird.y += bird.velocity * dt * 60;
    bird.angle = Math.min(Math.max(bird.velocity / 10, -Math.PI/4), Math.PI/2);

    // Обновление позиций труб
    pipes.forEach((pipe, index) => {
        // Движение отверстия только в сложном режиме
        if (pipeSpeed === SPEED_HARD) {
    pipe.offsetY += HOLE_MOVEMENT.SPEED * pipe.direction * dt * 60;
    
    // Плавное изменение направления без резких скачков
    if (Math.abs(pipe.offsetY) > HOLE_MOVEMENT.RANGE) {
        pipe.direction *= -1;
        // Убираем принудительную установку offsetY
    }
    
    // Ограничиваем смещение в допустимом диапазоне
    pipe.offsetY = Math.max(-HOLE_MOVEMENT.RANGE, 
        Math.min(HOLE_MOVEMENT.RANGE, pipe.offsetY));
    
    // Корректное обновление геометрии
    pipe.top.height = pipe.baseY + pipe.offsetY;
    pipe.bottom.y = pipe.top.height + gap;
    pipe.bottom.height = canvas.height - pipe.bottom.y;
}

        // Горизонтальное движение труб
        pipe.top.x -= pipeSpeed * dt * 60;
        pipe.bottom.x -= pipeSpeed * dt * 60;

        // Удаление труб, вышедших за левую границу
        if (pipe.top.x + PIPE_WIDTH < 0) {
            pipes.splice(index, 1);
            score++;
            updateCoins();
        }
    });

    // Проверка коллизий с каждой трубой
    pipes.forEach(pipe => {
        if (checkCollision(pipe)) {
            endGame();
        }
    });

    // Проверка столкновения с землей
    if (bird.y + bird.height >= canvas.height) {
        endGame();
    }

    // Генерация новых труб
    pipeTimer += dt;
    const spawnInterval = 5 / pipeSpeed;
    if (pipeTimer >= spawnInterval) {
        addPipe();
        pipeTimer = 0;
    }
}
// Функция проверки коллизий
function checkCollision(pipe) {
    const birdRight = bird.x + bird.width;
    const birdBottom = bird.y + bird.height;
    const pipeRight = pipe.top.x + PIPE_WIDTH;
    
    // Проверка горизонтального перекрытия
    if (birdRight < pipe.top.x || bird.x > pipeRight) {
        return false;
    }
    
    // Верхняя труба
    const topPipeBottom = pipe.top.y + pipe.top.height;
    if (bird.y < topPipeBottom) {
        return true;
    }
    
    // Нижняя труба
    const bottomPipeTop = pipe.bottom.y;
    if (birdBottom > bottomPipeTop) {
        return true;
    }
    
    return false;
}

function endGame() {
    isGameOver = true;
    totalCoins += coinsEarned;
    
    // Обновляем рекорд только для текущего уровня
    if (score > highScores[currentDifficulty]) {
        highScores[currentDifficulty] = score;
    }
    
    saveGameProgress();
    updateLeaderboard();
    
    document.getElementById('scoreDisplay').innerText = score;
    document.getElementById('highScoreDisplay').innerText = highScores[currentDifficulty];
    document.getElementById('coinsDisplay').innerText = `+${coinsEarned} 💰`;
    document.getElementById('gameOverPanel').style.display = 'block';
}
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawBird();
            drawPipes();
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeText(`Счет: ${score}`, 10, 25);
            ctx.fillText(`Счет: ${score}`, 10, 25);
            
            if (isPaused) {
                document.getElementById('pauseText').style.display = 'block';
            } else {
                document.getElementById('pauseText').style.display = 'none';
            }
        }

        function updateCoins() {
    if (isGameOver) return;

    if (score % levelCoinThreshold() === 0 && score > 0) {
        coinsEarned++;
        // Обновление отображения монет в главном меню
        updateCoinDisplay();
    }
}  

        function levelCoinThreshold() {
            switch (pipeSpeed) {
                case SPEED_EASY:
                    return 15; // Пройденные трубы для легкого уровня
                case SPEED_MEDIUM:
                    return 10; // Пройденные трубы для среднего уровня
                case SPEED_HARD:
                    return 5;  // Пройденные трубы для сложного уровня
                default:
                    return 15; // По умолчанию
            }
        }

        function updateCoinDisplay() {
        document.getElementById('coinDisplay').innerText = `${totalCoins} 💰`;
    }



     // Функция для установки выбранной птички
     function setSelectedBird(index) {
        shopItems[selectedBirdIndex].querySelector('p').innerText = 'Выбрать'; // Сбрасываем текст старой птички
        selectedBirdIndex = index; // Устанавливаем новый индекс
        shopItems[selectedBirdIndex].querySelector('p').innerText = '✔'; // Устанавливаем галочку под новой выбранной птичкой
    }

    // Пример для увеличения количества монет (используйте вашу логику здесь)
    function earnCoins(amount) {
        totalCoins += amount;
        updateCoinDisplay();
    }

    function gameLoop(timestamp) {
    if (isGameOver) return;
    
    if (!lastTime) lastTime = timestamp;
    deltaTime = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    update(deltaTime);
    draw();
    requestAnimationFrame(gameLoop); // Добавлен вызов функции
}

    document.addEventListener('keydown', (event) => {
        if (event.key === 'p') {
            isPaused = !isPaused;
            if (!isPaused && !isGameOver) {
                gameLoop();
            }
        }
        if (!isGameOver && !isPaused && event.key === ' ') { 
            bird.velocity = bird.lift; 
        }
    });

document.getElementById('easyBtn').addEventListener('click', () => {
    currentDifficulty = 'easy';
    startGame(SPEED_EASY);
});

document.getElementById('mediumBtn').addEventListener('click', () => {
    currentDifficulty = 'medium';
    startGame(SPEED_MEDIUM);
});

document.getElementById('hardBtn').addEventListener('click', () => {
    currentDifficulty = 'hard';
    startGame(SPEED_HARD);
});

function startGame(speed) {
    // Сброс игровых параметров
    pipes = [];
    score = 0;
    coinsEarned = 0;
    bird.y = canvas.height / 2;
    bird.velocity = 0;
    bird.angle = 0;
    isGameOver = false;
    isPaused = false;
    pipeTimer = 0;
    lastTime = 0;
    
    // Установка параметров сложности
    pipeSpeed = speed;
    switch (speed) {
        case SPEED_EASY:
            gap = GAP_EASY;
            HOLE_MOVEMENT.SPEED = 0; // Отключаем движение отверстий
            break;
        case SPEED_MEDIUM:
            gap = GAP_MEDIUM;
            HOLE_MOVEMENT.SPEED = 0; // Отключаем движение отверстий
            break;
        case SPEED_HARD:
            gap = GAP_HARD;
            HOLE_MOVEMENT.SPEED = 1.5; // Включаем движение отверстий
            break;
    }
    
    
    // Скрываем меню и показываем игровое поле
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('gameOverPanel').style.display = 'none';
    document.getElementById('pauseText').style.display = 'none';
    
    // Генерируем первую пару труб
    addPipe();
    
    // Запускаем игровой цикл
    requestAnimationFrame(gameLoop);
}



function resetGame() {
    lastTime = 0;
    deltaTime = 0;
    pipeTimer = 0;
    pipes = [];
    score = 0;
    bird.y = 150;
    bird.velocity = 0;
    bird.angle = 0;
    isGameOver = false;
    isPaused = false;
    coinsEarned = 0;
    
    document.getElementById('gameOverPanel').style.display = 'none';
    document.getElementById('pauseText').style.display = 'none';
    updateCoinDisplay();
    
    // Очистка и отрисовка фона
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    isPaused = false; // Добавить эту строку
    document.getElementById('pauseText').style.display = 'none';
}


function updatePanelSizes() {
    const canvasWidth = canvas.offsetWidth;
    const canvasHeight = canvas.offsetHeight;
    
    const panels = document.querySelectorAll('#mainMenu, #shopPanel');
    panels.forEach(panel => {
        panel.style.width = `${canvasWidth * 0.9}px`;
        panel.style.maxWidth = `${400 * 0.9}px`;
        panel.style.minHeight = `${canvasHeight * 0.8}px`;
    });
}

// Лидерборд (добавьте в gameOverPanel)
async function updateLeaderboard() {
    try {
        // Отправляем максимальный рекорд из всех режимов
        const maxScore = Math.max(highScores.easy, highScores.medium, highScores.hard);
        
        await vkBridge.send('VKWebAppSetLeaderboardScore', {
            leaderboard_id: 1, // ID вашего лидерборда в VK
            score: maxScore
        });
    } catch (err) {
        console.error('Ошибка лидерборда:', err);
    }
}


    document.getElementById('mainMenu').style.display = 'block'; // Сделать меню видимым

    document.getElementById('menuBtn').addEventListener('click', () => {
            saveGameProgress();
            resetGame(); // Сбросить игру
            document.getElementById('gameOverPanel').style.display = 'none'; // Скрыть табло "Игра окончена"
            document.getElementById('mainMenu').style.display = 'block'; // Показать главное меню
        });
document.getElementById('restartBtn').addEventListener('click', () => {
    resetGame();
    document.getElementById('gameOverPanel').style.display = 'none';
    
    // Сбрасываем игровые параметры
    lastTime = 0;
    deltaTime = 0;
    isGameOver = false;
    isPaused = false;
    pipes = [];
    score = 0;
    bird.y = canvas.height / 2;
    bird.velocity = 0;
    
    // Запускаем игру заново
    requestAnimationFrame(gameLoop);
});

document.getElementById('shopBtn').addEventListener('click', () => {
    document.getElementById('mainMenu').style.display = 'none'; // Скрываем главное меню
    document.getElementById('shopPanel').style.display = 'block'; // Показываем магазин
});

// Обработчик для кнопки "Закрыть" в окне магазина
document.getElementById('closeShopBtn').addEventListener('click', () => {
    document.getElementById('shopPanel').style.display = 'none'; // Скрываем магазин
    document.getElementById('mainMenu').style.display = 'block'; // Возвращаем главное меню
});

// В обработчиках ввода уберите любые модификации скорости
document.addEventListener('keydown', (event) => {
    if (!isGameOver && !isPaused && (event.key === ' ' || event.key === 'ArrowUp')) {
        bird.velocity = BIRD_PHYSICS.LIFT; // Чистый импульс без модификаторов
        bird.angle = BIRD_PHYSICS.ROTATION_RANGE.MAX; // Мгновенный поворот вверх
    }
});

// Для touch-устройств
document.addEventListener('touchstart', (event) => {
    event.preventDefault();
    if (!isGameOver && !isPaused) {
        bird.velocity = BIRD_PHYSICS.LIFT;
        bird.angle = BIRD_PHYSICS.ROTATION_RANGE.MAX;
    }
});

// Для тестирования, например, добавим кнопку, чтобы заработать 100 монет
document.getElementById('earnButton').addEventListener('click', () => {
        earnCoins(100);
    });



    function resizeCanvas() {
    const aspectRatio = 400 / 600; // Соотношение сторон (ширина на высоту)
    const width = Math.min(window.innerWidth, 400); // Максимальная ширина 400 пикселей
    const height = width / aspectRatio; // Рассчитываем высоту на основании ширины
    canvas.style.width = `${width}px`; // Устанавливаем ширину в CSS
    canvas.style.height = `${height}px`; // Устанавливаем высоту в CSS
    updatePanelSizes();
}

// После успешной авторизации
function updateAuthUI(user) {
    document.getElementById('authBtn').style.display = 'none';
    document.getElementById('userBadge').style.display = 'flex';
    document.getElementById('userName').textContent = user.first_name;
    
    // Обновляем аватар если есть
    if(user.photo_100) {
        document.getElementById('userAvatar').src = user.photo_100;
    }
}

window.addEventListener('resize', () => {
    resizeCanvas();
    updatePanelSizes();
});

// Добавьте в конец скрипта
document.addEventListener('DOMContentLoaded', async () => {
    await checkAuthOnLoad();
    resizeCanvas();
    updatePanelSizes();
    
    // Принудительное обновление интерфейса
    updateCoinDisplay();
    drawBackground();
    
    // Показываем меню
    document.getElementById('mainMenu').style.display = 'block';
});

// Обработчики для статистики
document.getElementById('statsBtn').addEventListener('click', () => {
    updateStatsDisplay();
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('statsPanel').style.display = 'block';
});

document.getElementById('closeStatsBtn').addEventListener('click', () => {
    document.getElementById('statsPanel').style.display = 'none';
    document.getElementById('mainMenu').style.display = 'block';
});

// Функция обновления статистики
function updateStatsDisplay() {
    document.getElementById('easyStats').textContent = highScores.easy;
    document.getElementById('mediumStats').textContent = highScores.medium;
    document.getElementById('hardStats').textContent = highScores.hard;
}

// Обработчики для кнопки информации
document.getElementById('infoBtn').addEventListener('click', () => {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('infoPanel').style.display = 'block';
});

document.getElementById('closeInfoBtn').addEventListener('click', () => {
    document.getElementById('infoPanel').style.display = 'none';
    document.getElementById('mainMenu').style.display = 'block';
});

// Обработчики для панели монет
document.getElementById('coinsBtn').addEventListener('click', () => {
    document.getElementById('shopPanel').style.display = 'none';
    document.getElementById('coinsPanel').style.display = 'block';
});

document.getElementById('closeCoinsBtn').addEventListener('click', () => {
    document.getElementById('coinsPanel').style.display = 'none';
    document.getElementById('shopPanel').style.display = 'block';
});

// Функция покупки монет
async function buyCoins(coins, price) {
    try {
        const result = await vkBridge.send('VKWebAppShowOrderBox', {
            type: 'item', 
            item: `coins_${coins}`, // Уникальный ID товара
            price: price * 100 // Цена в голосах (умножаем на 100)
        });

        if (result.status === 'success') {
            totalCoins += coins;
            updateCoinDisplay();
            saveGameProgress();
            alert(`Успешно куплено ${coins} монет!`);
        }
    } catch (error) {
        console.error('Ошибка покупки:', error);
        alert('Ошибка при покупке, попробуйте позже');
    }
}

// Обработчики для кнопок покупки
document.querySelectorAll('.coin-package').forEach(button => {
    button.addEventListener('click', function() {
        const coins = parseInt(this.dataset.coins);
        const price = parseInt(this.dataset.price);
        if (confirm(`Купить ${coins} монет за ${price} голосов?`)) {
            buyCoins(coins, price);
        }
    });
});

</script>